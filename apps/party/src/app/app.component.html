<destiny-webring></destiny-webring>
<div class="main-content">
  <div class="title-block section">
    <div class="title">
      <span class="srl srl-one">SRL</span>¹ is Dead<br />
      Long Live <span class="srl srl-two">SRL</span>²
    </div>
    <div class="footnotes">
      1: Sparrow Racing League <br />
      2: Synchronized Random Loadouts
    </div>
  </div>

  <mat-spinner *ngIf="manifestState === 'loading'"></mat-spinner>

  <div class="section" *ngIf="manifestState === 'erred'">
    Error loading Destiny Manifest
  </div>

  <mat-card class="section" *ngIf="manifestState === 'ready'">
    <mat-card-header>
      <mat-card-title>SRL²</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <div class="code-block">
        <code>{{
          searchText ||
            'Add Guardians, select options, then click the button to generate a DIM search query'
        }}</code>
      </div>
    </mat-card-content>

    <mat-card-actions>
      <button
        [disabled]="playerService.combinedSetsLoading | async"
        color="primary"
        (click)="randomize()"
        mat-raised-button
      >
        Randomize & Copy to Clipboard
      </button>
    </mat-card-actions>

    <mat-card-footer *ngIf="requiresPull">
      Some items may be in Collections
    </mat-card-footer>
  </mat-card>

  <div class="section" *ngIf="manifestState === 'ready'">
    <h2>Guardians</h2>
    <form (ngSubmit)="addPlayer()">
      <mat-form-field class="example-full-width">
        <mat-label>Bungie Name</mat-label>
        <input
          matInput
          placeholder="Name or Name#1234"
          [(ngModel)]="nameInput"
          [ngModelOptions]="{ standalone: true }"
        />
      </mat-form-field>
      <button color="primary" type="submit" mat-raised-button>Add</button>
    </form>
    <div class="player-cards">
      <destiny-player
        *ngFor="let player of players; index as i"
        [player]="player"
        [index]="i"
        [exotics]="exotics"
        [collectionExotics]="collectionExotics"
        [collectionNonExotics]="collectionNonExotics"
      ></destiny-player>

      <mat-card *ngIf="playerService.combinedSetsLoading | async">
        <mat-spinner></mat-spinner>
      </mat-card>
      <mat-card *ngIf="(playerService.combinedSetsLoading | async) === false">
        <mat-card-header>
          <mat-card-title>Commonality</mat-card-title>
        </mat-card-header>
        <mat-card-content> </mat-card-content>
        <mat-card-actions>
          <mat-chip-set>
            <mat-chip class="non-exotics">
              {{ nonExoticCount }} Non-Exotics
            </mat-chip>
            <mat-chip *ngIf="exotics !== 'exclude'" class="exotics">
              {{ exoticCount }} Exotics
            </mat-chip>
          </mat-chip-set>
        </mat-card-actions>
      </mat-card>
    </div>
  </div>

  <div class="section">
    <h2>Options</h2>

    <div class="option-cards">
      <mat-card>
        <mat-card-header>
          <mat-card-title>Exotics</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <mat-radio-group
            aria-label="Exotics"
            [(ngModel)]="exotics"
            (change)="updateCounts()"
          >
            <mat-radio-button value="exclude">Never</mat-radio-button>
            <mat-radio-button value="include" [checked]="true"
              >Sometimes</mat-radio-button
            >
            <mat-radio-button value="required">Always</mat-radio-button>
          </mat-radio-group>
        </mat-card-content>
      </mat-card>

      <mat-card>
        <mat-card-header
          ><mat-card-title>Collections</mat-card-title></mat-card-header
        >
        <mat-card-content>
          <mat-checkbox
            [(ngModel)]="collectionNonExotics"
            (change)="updateCounts()"
            >Non-Exotics</mat-checkbox
          ><br />
          <mat-checkbox
            *ngIf="exotics !== 'exclude'"
            [(ngModel)]="collectionExotics"
            (change)="updateCounts()"
            >Exotics</mat-checkbox
          >
        </mat-card-content>
      </mat-card>

      <mat-card>
        <mat-card-header>
          <mat-card-title>Discord Integration</mat-card-title>
          <mat-card-subtitle
            >Automatically send search text to a Discord
            channel</mat-card-subtitle
          >
        </mat-card-header>
        <mat-card-content>
          <mat-form-field color="accent">
            <mat-label>Discord Webhook URL</mat-label>
            <input
              title="Discord Webhook URL"
              matInput
              [(ngModel)]="discordWebhookUrl"
              type="password"
            />
          </mat-form-field>
          <mat-form-field color="accent">
            <mat-label>Thread ID (optional)</mat-label>
            <input
              title="Thread ID"
              matInput
              [(ngModel)]="discordThreadId"
              type="password"
            />
          </mat-form-field>
        </mat-card-content>
      </mat-card>
    </div>
  </div>

  <mat-expansion-panel hideToggle>
    <mat-expansion-panel-header>
      <mat-panel-title> Help </mat-panel-title>
    </mat-expansion-panel-header>

    <p>
      Make sure all Guardians have the following two options enabled in their
      <a
        rel="noopener"
        href="https://www.bungie.net/7/en/User/Account/Privacy"
        target="_blank"
        >Bungie.net Privacy Settings</a
      >:
    </p>
    <ul>
      <li>Show my non-equipped Inventory</li>
      <li>Show my progression</li>
    </ul>
    <p>It may take a few minutes for Privacy Settings changes to be applied.</p>
    <img
      alt="screenshot showing the location of the relevant settings on bungie.net"
      src="./assets/privacy.png"
    />
  </mat-expansion-panel>
</div>
